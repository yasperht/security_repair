use security_repair

db.createCollection("clientes", {
    validator: {
        $jsonSchema: {
            bsonType: "object",
            required: ["nombre", "apellido_paterno", "apellido_materno", "telefono"],
            properties: {
                nombre: {
                    bsonType: "string",
                    description: "El nombre del usuario no puede estar vacío"
                },
                apellido_paterno: {
                    bsonType: "string",
                    description: "El apellido paterno del usuario no puede estar vacío"
                },
                apellido_materno: {
                    bsonType: "string",
                    description: "El apellido materno del usuario no puede estar vacío"
                },
                telefono: {
                    bsonType: "string",
                    pattern: "^[1-9][0-8]{8}$",
                    description: "El teléfono del usuario no puede estar vacío"
                }
            }
        }
    }
})


db.createCollection("servicios_tecnicos", {
    validator:{
        $jsonSchema: {
            bsonType: "object",
            required: ["nombre", "razon_social", "ruc"],
            properties: {
                nombre: {
                    bsonType: "string",
                    description: "El nombre del servicio técnico no debe estar vicio."
                },
                razon_social: {
                    bsonType: "string",
                    description: "La razón social del servicio técnico no debe estar vicio."
                },
                ruc: {
                    bsonType: "string",
                    pattern: "^[1-9][0-9]{10}$",
                    description: "El RUC del servicio técnico no debe estar vicio."
                }
            }
        }
    }
})


db.createCollection("tecnicos", {
    validator: {
        $jsonSchema:{
            bsonType: "object",
            required: ["nombre", "apellido_paterno", "apellido_materno"],
            properties: {
                nombre: {
                    bsonType: "string",
                    description: "El nombre del técnico no puede estar vacío"
                },
                apellido_paterno: {
                    bsonType: "string",
                    description: "El apellido paterno del técnico no puede estar vacío"
                },
                apellido_materno: {
                    bsonType: "string",
                    description: "El apellido materno del técnico no puede estar vacío"
                },
           }
        }
    }
})

db.createCollection("reparaciones", {
    validator:{
        $jsonSchema: {
            bsonType: "object",
            required: ["clientes_id", "servicios_tecnicos_id", "tecnicos_id", "precio"],
            properties: {
                clientes_id: {
                    bsonType: "objectId",
                    description: "Referencia al cliente"
                },
                servicios_tecnicos_id: {
                    bsonType: "objectId",
                    description: "Referencia al servicio técnico"
                },
                tecnicos_id:{
                    bsonType: "objectId",
                    description: "Referencia al técnico"
                },
                precio: {
                    bsonType: "number",
                    description: "El precio no debe estar vacío"
                }
            }
        }
    }
})

//Alterando el Schema Validation
db.runCommand({
    collMod: "reparaciones",
    validator:{
        $jsonSchema: {
            bsonType: "object",
            required: ["clientes_id", "servicios_tecnicos_id", "tecnicos_id", "precio"],
            properties: {
                clientes_id: {
                    bsonType: "objectId",
                    description: "Referencia al cliente"
                },
                servicios_tecnicos_id: {
                    bsonType: "objectId",
                    description: "Referencia al servicio técnico"
                },
                tecnicos_id:{
                    bsonType: "objectId",
                    description: "Referencia al técnico"
                },
                precio: {
                    bsonType: "number",
                    description: "El precio no debe estar vacío"
                }
            }
        }
    }
})


db.createCollection("equipos", {
    validator:{
        $jsonSchema: {
            bsonType: "object",
            required: ["dispositivo", "marca", "modelo"],
            properties: {
                dispositivo: {
                    bsonType: "string",
                    description: "Es el tipo de equipo como celular, computadora, laptop, etc."
                },
                marca: {
                    bsonType: "string",
                    description: "Es la empresa fabricante como samsung, huawei, asus, hp, etc."
                },
                modelo: {
                    bsonType: "string",
                    description: "Por ejemplo, celular Samsung S10+, laptop HP 15230, TV LG Qled 4K, etc."
                }
            }
        }
    }
})

show collections

//***********************
//Incrustando documentos
//**********************

db.clientes.insertMany([
  {
    nombre: "Iker",
    apellido_paterno: "Soto",
    apellido_materno: "Vega",
    telefono: "935782416"
  },
  {
    nombre: "Valeria",
    apellido_paterno: "Navarro",
    apellido_materno: "López",
    telefono: "925603841"
  },
  {
    nombre: "Maximiliano",
    apellido_paterno: "Herrera",
    apellido_materno: "Silva",
    telefono: "942358671"
  },
  {
    nombre: "Abril",
    apellido_paterno: "González",
    apellido_materno: "Morales",
    telefono: "920514837"
  },
  {
    nombre: "Leandro",
    apellido_paterno: "Fernández",
    apellido_materno: "Rojas",
    telefono: "912647530"
  }
])

db.createCollection("comentarios", {
    validator:{
        $jsonSchema: {
            bsonType: "object",
            required: ["clientes_id", "servicios_tecnicos_id", "puntaje"],
            properties: {
                clientes_id: {
                    bsonType: "objectId",
                    description: "Referencia al cliente"
                },
                servicios_tecnicos_id: {
                    bsonType: "objectId",
                    description: "Referencia al servicio técnico"
                },
                puntaje: {
                    bsonType: "double",
                    minimum: 1,
                    maximum: 5,
                    description: "Puntaje que le da el cliente al servicio técnico"
                }
            }
        }
    }
})

db.servicios_tecnicos.insertMany([
  {
    nombre: "Smartphones Perú",
    razon_social: "ElectroCell S.A.C",
    ruc: "20123456789",
    fecha_fundacion: ISODate("2010-05-15")
  },
  {
    nombre: "Servicio Técnico PC Master",
    razon_social: "TecnoMaster S.A.C",
    ruc: "30123456789"
  },
  {
    nombre: "Laptop Repair",
    razon_social: "TechFix S.A.C",
    ruc: "40123456789",
    fecha_fundacion: ISODate("2005-12-01")
  },
  {
    nombre: "TV Expert",
    razon_social: "ElectroVisión S.A.C",
    ruc: "50123456789"
  },
  {
    nombre: "Electrónica Total",
    razon_social: "SmartTech S.A.C",
    ruc: "60123456789",
    fecha_fundacion: ISODate("2008-09-10")
  }
]);

db.clientes.find()
db.servicios_tecnicos.find()



db.comentarios.insertMany ([
    {
        clientes_id: ObjectId("648d7fcc628601142874f6fd"),
        servicios_tecnicos_id: ObjectId("648d8947628601142874f757"),
        puntaje: 4.2,
        descripcion: "Excelente servicio, rápidos y eficientes"
    },
    {
        clientes_id: ObjectId("648d8204628601142874f74f"),
        servicios_tecnicos_id: ObjectId("648d8947628601142874f758"),
        puntaje: 3.8,
        descripcion: "Buen trabajo, solucionaron el problema rápidamente"
    },
    {
        clientes_id: ObjectId("648d8204628601142874f750"),
        servicios_tecnicos_id: ObjectId("648d8947628601142874f759"),
        puntaje: 4.5,
        descripcion: "Muy satisfecho con el servicio, los recomiendo"
    },
    {
        clientes_id: ObjectId("648d8204628601142874f751"),
        servicios_tecnicos_id: ObjectId("648d8947628601142874f75a"),
        puntaje: 2.1
    }
])

db.comentarios.find()
